"use strict";(self.webpackChunk_roots_bud_sage=self.webpackChunk_roots_bud_sage||[]).push([[1561],{"./scripts/components/load-more-articles.js":(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});class i{constructor({el:t,endpoint:e,maxRequest:s,categoryKey:i,searchKey:n}){this.requestWasSent=!1,this.el=t.querySelector(".load-more-articles"),this.noRequestOnInit=this.el?.classList?.contains("no-request-on-init"),this.contentSection=t.querySelector(".load-more-container"),this.track=this.el?.querySelector(".load-more-articles__track"),this.button=this.el?.querySelector(".load-more-articles__button"),this.buttonInitialized=!1,this.page=1,this.endpoint=e,this.initMaxRequest=s?Number(s)||0:2,this.maxAutoRequest=this.initMaxRequest,this.getContent=this.getContent.bind(this),this.categoryKey=i,this.searchKey=n,this.controller=new AbortController,this.init()}reset(){this.controller?.abort(),this.noRequestOnInit=!1,this.pagination=null,this.page=0,this.maxAutoRequest=this.initMaxRequest,this.contentSection.innerHTML="",this.buttonInitialized=!1,this.requestWasSent=!1,this.el?.classList.remove("load-more-articles_show-button"),this.button?.removeEventListener("click",this.getContent)}async getContent(t){if(t?.preventDefault(),this.pagination&&this.pagination.max_num_pages===this.page)return;if(this.requestWasSent)return;this.el?.classList.add("requesting"),this.requestWasSent=!0,this.page+=1;const e=new URL(`${this.endpoint}`);e.searchParams.set("page",this.page),e.searchParams.set("nonce",window.api.nonce);const s=new URLSearchParams(window.location.search),i=s.get(this.categoryKey);i&&e.searchParams.append(this.categoryKey,i);const n=s.get(this.searchKey);n&&e.searchParams.append(this.searchKey,n);let a="";try{this.controller=new AbortController;const t=await fetch(e.toString(),{signal:this.controller.signal}),{data:s,pagination:i}=await t.json();if(a=s,this.el?.classList.remove("requesting"),!i)throw new Error;this.pagination=i,this.page=this.pagination.current_page,this.pagination.max_num_pages===this.page?(this.el?.classList.remove("load-more-articles_show-button"),this.button?.removeEventListener("click",this.getContent)):this.page>=this.maxAutoRequest&&this.initLoadButton()}catch(t){this.pagination={max_num_pages:this.page},this.el?.classList.remove("load-more-articles_show-button")}finally{Array.isArray(a)?this.contentSection.insertAdjacentHTML("beforeend",a.reduce((t,e)=>t+e,"")):a&&this.contentSection.insertAdjacentHTML("beforeend",a),this.el?.classList.remove("requesting"),this.requestWasSent=!1}}initLoadButton(){this.el?.classList.add("load-more-articles_show-button"),this.button&&!this.buttonInitialized&&(this.buttonInitialized=!0,this.button.addEventListener("click",this.getContent))}init(){if(!this.contentSection||!this.track)return;0===this.maxAutoRequest&&this.initLoadButton();new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(this.noRequestOnInit||this.page<=this.maxAutoRequest&&this.getContent())})},{threshold:0}).observe(this.track)}}}}]);